<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clinic Appointment Booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }

    .card {
      max-width: 500px;
      margin: auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    select, input, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    .loading {
      font-style: italic;
      color: #555;
    }

    .error {
      color: red;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Book an Appointment</h2>

    <label for="dateSelect">Select Date:</label>
    <select id="dateSelect"></select>

    <label for="slotSelect">Available Time Slots:</label>
    <select id="slotSelect">
      <option>Loading...</option>
    </select>

    <button onclick="bookNow()">Submit Booking</button>

    <p id="status" class="loading"></p>
  </div>

  <script>
    const slotSelect = document.getElementById('slotSelect');
    const dateSelect = document.getElementById('dateSelect');
    const statusText = document.getElementById('status');

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function loadNext7Days() {
      const today = new Date();
      for (let i = 0; i < 7; i++) {
        const day = new Date(today);
        day.setDate(today.getDate() + i);
        if (day.getDay() === 0) continue; // skip Sunday

        const option = document.createElement('option');
        option.value = formatDate(day);
        option.textContent = day.toDateString();
        dateSelect.appendChild(option);
      }
    }

    async function fetchSlots(date) {
      slotSelect.innerHTML = `<option>Loading...</option>`;
      statusText.textContent = 'Fetching available slots...';

      try {
        const res = await fetch('https://yourdomain.com/webhook/available-slots', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ selectedDate: date })
        });

        if (!res.ok) throw new Error('Failed to fetch slots');

        const slots = await res.json();
        slotSelect.innerHTML = '';

        if (slots.length === 0) {
          slotSelect.innerHTML = `<option disabled>No slots available</option>`;
        } else {
          for (const slot of slots) {
            const option = document.createElement('option');
            option.value = slot.value;
            option.textContent = slot.label;
            slotSelect.appendChild(option);
          }
        }

        statusText.textContent = '';
      } catch (error) {
        slotSelect.innerHTML = `<option disabled>Error loading slots</option>`;
        statusText.textContent = `❌ ${error.message}`;
        statusText.className = 'error';
      }
    }

    function bookNow() {
      const selectedDate = dateSelect.value;
      const selectedSlot = slotSelect.value;
      alert(`Booking submitted for ${selectedDate} at ${selectedSlot}`);
      // Extend here to send data to /submit-booking
    }

    // Initial Setup
    loadNext7Days();

    dateSelect.addEventListener('change', () => {
      const selectedDate = dateSelect.value;
      fetchSlots(selectedDate);
    });

    // Trigger initial load
    setTimeout(() => {
      if (dateSelect.value) fetchSlots(dateSelect.value);
    }, 200);
  </script>
</body>
</html>

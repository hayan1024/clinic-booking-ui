<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clinic Appointment Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <div class="max-w-xl mx-auto p-6 mt-10 bg-white rounded-2xl shadow-lg">
      <h1 class="text-2xl font-bold mb-4 text-center">Clinic Appointment Booking</h1>
      <form id="bookingForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium">Full Name</label>
          <input name="fullName" required placeholder="Enter your full name" class="mt-1 block w-full p-2 border border-gray-300 rounded-xl" />
        </div>
        <div>
          <label class="block text-sm font-medium">Reason for Visit</label>
          <input name="reason" required placeholder="e.g., Consultation, Follow-up" class="mt-1 block w-full p-2 border border-gray-300 rounded-xl" />
        </div>
        <div>
          <label class="block text-sm font-medium">Phone Number</label>
          <input name="phone" required placeholder="e.g., +966512345678" class="mt-1 block w-full p-2 border border-gray-300 rounded-xl" />
        </div>
        <div>
          <label class="block text-sm font-medium">Email</label>
          <input name="email" type="email" required placeholder="e.g., you@example.com" class="mt-1 block w-full p-2 border border-gray-300 rounded-xl" />
        </div>
        <div>
          <label class="block text-sm font-medium">Select Date</label>
          <select name="date" id="dateSelect" required class="mt-1 block w-full p-2 border border-gray-300 rounded-xl"></select>
        </div>
        <div>
          <label class="block text-sm font-medium">Select Time Slot</label>
          <select name="timeSlot" id="slotSelect" class="mt-1 block w-full p-2 border border-gray-300 rounded-xl">
            <option value="">-- Please choose a date first --</option>
          </select>
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded-xl font-semibold hover:bg-blue-700">Submit</button>
      </form>
      <div id="status" class="text-center mt-4 text-sm"></div>
    </div>

    <script>
      // Populate the date dropdown
      const dateSelect = document.getElementById('dateSelect');
      const slotSelect = document.getElementById('slotSelect');
      const today = new Date();

      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);

        // Skip Sundays
        if (date.getDay() === 0) continue;

        const label = date.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        const value = date.toISOString().split('T')[0];

        const option = document.createElement('option');
        option.value = value;
        option.textContent = label;
        dateSelect.appendChild(option);
      }

      dateSelect.addEventListener('change', async () => {
        slotSelect.innerHTML = '<option>Loading...</option>';
        const selectedDate = dateSelect.value;

        try {
          const res = await fetch('https://hayan1024.app.n8n.cloud/webhook-test/available-slots', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ date: selectedDate })
          });

          const data = await res.json();
          const slots = data.slots || [];

          slotSelect.innerHTML = '';

          if (slots.length === 0) {
            const opt = document.createElement('option');
            opt.value = '';
            opt.textContent = 'No available slots';
            slotSelect.appendChild(opt);
          } else {
            slotSelect.appendChild(new Option('-- Select Time Slot --', ''));
            slots.forEach(slot => {
              const opt = document.createElement('option');
              opt.value = slot.value;
              opt.textContent = slot.label;
              slotSelect.appendChild(opt);
            });
          }
        } catch (err) {
          slotSelect.innerHTML = '<option>Error loading slots</option>';
        }
      });

      document.getElementById('bookingForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = Object.fromEntries(new FormData(e.target).entries());

        try {
          const res = await fetch('https://hayan1024.app.n8n.cloud/webhook-test/available-slots', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          if (res.ok) {
            document.getElementById('status').textContent = 'Form submitted successfully!';
            e.target.reset();
            slotSelect.innerHTML = '<option>-- Please choose a date first --</option>';
          } else {
            document.getElementById('status').textContent = 'Submission failed.';
          }
        } catch (err) {
          document.getElementById('status').textContent = 'Error submitting form.';
        }
      });
    </script>
  </body>
</html>

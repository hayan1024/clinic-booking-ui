<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clinic Appointment Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
    }
    select, input, textarea, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 8px;
    }
  </style>
</head>
<body>

  <h2>Clinic Appointment Form</h2>

  <form id="appointmentForm">
    <label>Full Name</label>
    <input type="text" name="fullName" required>

    <label>Email</label>
    <input type="email" name="email" required>

    <label>Phone Number</label>
    <input type="tel" name="phone" required>

    <label>Reason for Visit</label>
    <textarea name="reason" required></textarea>

    <label>Select Appointment Date</label>
    <select id="dateSelect" name="selectedDate" required>
      <option value="">Select a date</option>
    </select>

    <label>Available Time Slot</label>
    <select id="slotSelect" name="selectedSlot" required>
      <option value="">Loading...</option>
    </select>

    <button type="submit">Book Appointment</button>
  </form>

  <script>
    // STEP 1: Populate date dropdown (next 7 days excluding Sundays)
    const dateSelect = document.getElementById('dateSelect');
    const slotSelect = document.getElementById('slotSelect');
    const today = new Date();
    for (let i = 0; i < 7; i++) {
      const date = new Date();
      date.setDate(today.getDate() + i);
      if (date.getDay() !== 0) { // exclude Sundays
        const yyyyMMdd = date.toISOString().split('T')[0]; // format: YYYY-MM-DD
        const option = document.createElement('option');
        option.value = yyyyMMdd;
        option.textContent = date.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        dateSelect.appendChild(option);
      }
    }

    // STEP 2: Fetch available time slots when a date is selected
    dateSelect.addEventListener('change', async () => {
      const selectedDate = dateSelect.value;
      slotSelect.innerHTML = '<option>Loading available time slots...</option>';

      try {
        const response = await fetch('https://hayan1024.app.n8n.cloud/webhook-test/available-slots', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ selectedDate })
        });
        const slots = await response.json();

        slotSelect.innerHTML = '';
        if (slots.length === 0) {
          slotSelect.innerHTML = '<option disabled selected>All slots booked. Try another date.</option>';
        } else {
          slotSelect.innerHTML = '<option value="">Select a time slot</option>';
          slots.forEach(slot => {
            const option = document.createElement('option');
            option.value = slot.slotStartISO;
            option.textContent = slot.timeLabel;
            slotSelect.appendChild(option);
          });
        }
      } catch (err) {
        console.error('Error fetching slots:', err);
        slotSelect.innerHTML = '<option disabled selected>Error loading slots</option>';
      }
    });

    // STEP 3: Submit full form to n8n on second webhook
    document.getElementById('appointmentForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        fullName: e.target.fullName.value,
        email: e.target.email.value,
        phone: e.target.phone.value,
        reason: e.target.reason.value,
        selectedDate: e.target.selectedDate.value,
        selectedSlot: e.target.selectedSlot.value
      };

      try {
        const res = await fetch('https://hayan1024.app.n8n.cloud/webhook-test/submit-booking', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        if (res.ok) {
          alert('Appointment booked successfully!');
          e.target.reset();
          slotSelect.innerHTML = '<option>Select a date first</option>';
        } else {
          alert('Booking failed. Ple
